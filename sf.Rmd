---
title: "sf - simple feature"
output:
  html_document:
    df_print: paged
---

Tabela de crimes em são paulo baixados:

https://www.kaggle.com/danlessa/geospatial-sao-paulo-crime-database

```{r}
library(tmap)
library(sf)
crimes = read.csv("data/crimes.csv")
```

Criando um objeto do tipo sf (simple feature) a partir do dataframe crimes, o sf é um data frame georreferenciado:

```{r}
library(sf)
sf_crimes <- st_as_sf(x = crimes, coords = c("longitude", "latitude"), crs = st_crs(4326))
```

crs: coordinate reference system

Plotando somente os pontos:

```{r}
tmap_mode("plot")
tm_shape(shp = sf_crimes) + 
  tm_dots(col = "deepskyblue4", 
          border.col = "black", 
          size = 0.2, 
          alpha = 0.8)
```

Ativando a opção de baixar mapas, para desativar:

```{r}
tmap_mode("view") # para desativar tmap_mode("plot")
```

Re-plotando os pontos no mapa do openstreetmap:

```{r}
tm_shape(shp = sf_crimes) + 
  tm_dots(col = "deepskyblue4", 
          border.col = "black", 
          size = 0.1, 
          alpha = 0.8)
```

```{r message=FALSE, warning=FALSE}
library(rgdal)
shapefile_SP <- readOGR(dsn = "data/shapefiles/SP_Municipios", layer = "SP")
```

Combinando sf e shapefile:

```{r}
tmap_mode("plot")
tm_shape(shp = shapefile_SP) + 
  tm_borders(alpha = 0.5) +
  tm_shape(shp = sf_crimes) + 
    tm_dots(col = "deepskyblue4", 
          border.col = "black", 
          size = 0.1, 
          alpha = 0.8)
```
Usando a camada do openstreetmap:

```{r}
tmap_mode("view")
tm_shape(shp = shapefile_SP) + 
  tm_borders(alpha = 0.5) +
  tm_shape(shp = sf_crimes) + 
    tm_dots(col = "deepskyblue4", 
          border.col = "black", 
          size = 0.1, 
          alpha = 0.8)
```